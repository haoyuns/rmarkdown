<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Modeling with Data in the Tidyverse | Statistician with R</title>
  <meta name="description" content="3 Modeling with Data in the Tidyverse | Statistician with R" />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Modeling with Data in the Tidyverse | Statistician with R" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Modeling with Data in the Tidyverse | Statistician with R" />
  
  
  




  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="exploratory-data-analysis.html"/>
<link rel="next" href="correlation-and-regression-in-r.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />












</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Statistician with R</a></li>
<li class="chapter" data-level="1" data-path="intro-to-data-in-r.html"><a href="intro-to-data-in-r.html"><i class="fa fa-check"></i><b>1</b> Intro to Data in R</a>
<ul>
<li class="chapter" data-level="1.1" data-path="intro-to-data-in-r.html"><a href="intro-to-data-in-r.html#dealing-with-factors"><i class="fa fa-check"></i><b>1.1</b> Dealing with factors</a></li>
<li class="chapter" data-level="1.2" data-path="intro-to-data-in-r.html"><a href="intro-to-data-in-r.html#types-of-variables"><i class="fa fa-check"></i><b>1.2</b> Types of variables</a></li>
<li class="chapter" data-level="1.3" data-path="intro-to-data-in-r.html"><a href="intro-to-data-in-r.html#types-of-studies"><i class="fa fa-check"></i><b>1.3</b> Types of studies</a></li>
<li class="chapter" data-level="1.4" data-path="intro-to-data-in-r.html"><a href="intro-to-data-in-r.html#scope-of-inference-统计推断"><i class="fa fa-check"></i><b>1.4</b> Scope of inference 统计推断</a></li>
<li class="chapter" data-level="1.5" data-path="intro-to-data-in-r.html"><a href="intro-to-data-in-r.html#sampling"><i class="fa fa-check"></i><b>1.5</b> Sampling</a></li>
<li class="chapter" data-level="1.6" data-path="intro-to-data-in-r.html"><a href="intro-to-data-in-r.html#principles-of-experimental-design"><i class="fa fa-check"></i><b>1.6</b> Principles of experimental design</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html"><i class="fa fa-check"></i><b>2</b> Exploratory Data Analysis</a>
<ul>
<li class="chapter" data-level="2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exploring-categorical-data"><i class="fa fa-check"></i><b>2.1</b> Exploring categorical data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#counts-vs-proportions"><i class="fa fa-check"></i><b>2.1.1</b> Counts vs Proportions</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#exploring-numerical-data"><i class="fa fa-check"></i><b>2.2</b> Exploring Numerical Data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#distribution-of-one-variable"><i class="fa fa-check"></i><b>2.2.1</b> Distribution of one variable</a></li>
<li class="chapter" data-level="2.2.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#visualization-in-higher-dimensions"><i class="fa fa-check"></i><b>2.2.2</b> Visualization in higher dimensions</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#numerical-summaries"><i class="fa fa-check"></i><b>2.3</b> Numerical Summaries</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#measures-of-center-and-variability"><i class="fa fa-check"></i><b>2.3.1</b> Measures of Center and Variability</a></li>
<li class="chapter" data-level="2.3.2" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#shape-and-transformations"><i class="fa fa-check"></i><b>2.3.2</b> Shape and transformations</a></li>
<li class="chapter" data-level="2.3.3" data-path="exploratory-data-analysis.html"><a href="exploratory-data-analysis.html#zero-inflation-strategies"><i class="fa fa-check"></i><b>2.3.3</b> Zero inflation strategies</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html"><i class="fa fa-check"></i><b>3</b> Modeling with Data in the Tidyverse</a>
<ul>
<li class="chapter" data-level="3.1" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#introduction-to-modeling"><i class="fa fa-check"></i><b>3.1</b> Introduction to Modeling</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#the-modeling-problem-for-explanation"><i class="fa fa-check"></i><b>3.1.1</b> The modeling problem for explanation</a></li>
<li class="chapter" data-level="3.1.2" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#the-modeling-problem-for-prediction"><i class="fa fa-check"></i><b>3.1.2</b> The modeling problem for prediction</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#modeling-with-basic-regression"><i class="fa fa-check"></i><b>3.2</b> Modeling with Basic Regression</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#refresher-modeling-in-general"><i class="fa fa-check"></i><b>3.2.1</b> Refresher: Modeling in general</a></li>
<li class="chapter" data-level="3.2.2" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#modeling-with-basic-regression-1"><i class="fa fa-check"></i><b>3.2.2</b> Modeling with Basic Regression</a></li>
<li class="chapter" data-level="3.2.3" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#predicted-value"><i class="fa fa-check"></i><b>3.2.3</b> Predicted value</a></li>
<li class="chapter" data-level="3.2.4" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#prediction-error"><i class="fa fa-check"></i><b>3.2.4</b> Prediction error</a></li>
<li class="chapter" data-level="3.2.5" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#fitting-a-regression-with-a-categorical-x"><i class="fa fa-check"></i><b>3.2.5</b> Fitting a regression with a categorical x</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#modeling-with-multiple-regression"><i class="fa fa-check"></i><b>3.3</b> Modeling with Multiple Regression</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#combining-numerical-variables"><i class="fa fa-check"></i><b>3.3.1</b> Combining numerical variables</a></li>
<li class="chapter" data-level="3.3.2" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#combining-numerical-and-categorical-variables"><i class="fa fa-check"></i><b>3.3.2</b> Combining numerical and categorical variables</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#model-assessment-and-selection"><i class="fa fa-check"></i><b>3.4</b> Model Assessment and Selection</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#assessing-with-sum-of-squared-residuals"><i class="fa fa-check"></i><b>3.4.1</b> Assessing with sum of squared residuals</a></li>
<li class="chapter" data-level="3.4.2" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#assessing-with-r-squared"><i class="fa fa-check"></i><b>3.4.2</b> Assessing with R-squared</a></li>
<li class="chapter" data-level="3.4.3" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#assessing-predictions-with-rmse"><i class="fa fa-check"></i><b>3.4.3</b> Assessing predictions with RMSE</a></li>
<li class="chapter" data-level="3.4.4" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#validation-set-prediction-framework"><i class="fa fa-check"></i><b>3.4.4</b> “Validation set” prediction framework</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="modeling-with-data-in-the-tidyverse.html"><a href="modeling-with-data-in-the-tidyverse.html#where-to-go-from-here"><i class="fa fa-check"></i><b>3.5</b> Where to go from here?</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html"><i class="fa fa-check"></i><b>4</b> Correlation and Regression in R</a>
<ul>
<li class="chapter" data-level="4.1" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#visualizing-two-variables"><i class="fa fa-check"></i><b>4.1</b> Visualizing two variables</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#bivariate-relationships"><i class="fa fa-check"></i><b>4.1.1</b> Bivariate relationships</a></li>
<li class="chapter" data-level="4.1.2" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#graphical-representations"><i class="fa fa-check"></i><b>4.1.2</b> Graphical representations</a></li>
<li class="chapter" data-level="4.1.3" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#characterizing-bivariate-relationships"><i class="fa fa-check"></i><b>4.1.3</b> Characterizing bivariate relationships</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#correlation"><i class="fa fa-check"></i><b>4.2</b> Correlation</a>
<ul>
<li class="chapter" data-level="4.2.1" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#pearson-product-moment-correlation"><i class="fa fa-check"></i><b>4.2.1</b> Pearson product-moment correlation</a></li>
<li class="chapter" data-level="4.2.2" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#francis-anscombe-dataset"><i class="fa fa-check"></i><b>4.2.2</b> <em>Francis Anscombe</em> dataset</a></li>
<li class="chapter" data-level="4.2.3" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#spurious-correlations"><i class="fa fa-check"></i><b>4.2.3</b> Spurious correlations</a></li>
</ul></li>
<li class="chapter" data-level="4.3" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#simple-linear-regression"><i class="fa fa-check"></i><b>4.3</b> Simple linear regression</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#visualization-of-linear-models"><i class="fa fa-check"></i><b>4.3.1</b> Visualization of linear models</a></li>
<li class="chapter" data-level="4.3.2" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#understanding-linear-models"><i class="fa fa-check"></i><b>4.3.2</b> Understanding linear models</a></li>
<li class="chapter" data-level="4.3.3" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#regression-vs.-regression-to-the-mean"><i class="fa fa-check"></i><b>4.3.3</b> Regression vs. Regression to the mean</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#interpreting-regression-models"><i class="fa fa-check"></i><b>4.4</b> Interpreting regression models</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#the-lm-summary-output"><i class="fa fa-check"></i><b>4.4.1</b> The <code>lm</code> summary output</a></li>
<li class="chapter" data-level="4.4.2" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#fitted-values-and-residuals"><i class="fa fa-check"></i><b>4.4.2</b> Fitted values and residuals</a></li>
<li class="chapter" data-level="4.4.3" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#tidying-your-linear-model"><i class="fa fa-check"></i><b>4.4.3</b> Tidying your linear model</a></li>
<li class="chapter" data-level="4.4.4" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#making-predictions"><i class="fa fa-check"></i><b>4.4.4</b> Making predictions</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#model-fit"><i class="fa fa-check"></i><b>4.5</b> Model fit</a>
<ul>
<li class="chapter" data-level="4.5.1" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#comparing-model-fits"><i class="fa fa-check"></i><b>4.5.1</b> Comparing model fits</a></li>
<li class="chapter" data-level="4.5.2" data-path="correlation-and-regression-in-r.html"><a href="correlation-and-regression-in-r.html#unusual-points"><i class="fa fa-check"></i><b>4.5.2</b> Unusual points</a></li>
</ul></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Statistician with R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="modeling-with-data-in-the-tidyverse" class="section level1" number="3">
<h1><span class="header-section-number">3</span> Modeling with Data in the Tidyverse</h1>
<div id="introduction-to-modeling" class="section level2" number="3.1">
<h2><span class="header-section-number">3.1</span> Introduction to Modeling</h2>
<p>General modeling framework formula:<br />
<span class="math inline">\(y = f(\overrightarrow{x}) + \epsilon\)</span></p>
<ul>
<li><span class="math inline">\(y\)</span>: outcome variable of interest, the phenomenon you wish to model</li>
<li><span class="math inline">\(\overrightarrow{x}\)</span>: explanatory/predictor variables used to inform your model</li>
<li><span class="math inline">\(f()\)</span>: function of the relationship between <span class="math inline">\(y\)</span> and <span class="math inline">\(x\)</span> (<em>the signal</em>)</li>
<li><span class="math inline">\(\epsilon\)</span>: unsystematic error component (<em>the noise</em>)</li>
</ul>
<div id="the-modeling-problem-for-explanation" class="section level3" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> The modeling problem for explanation</h3>
<p><span class="math inline">\(y = f(\overrightarrow{x}) + \epsilon\)</span></p>
<ol style="list-style-type: decimal">
<li><p>usually you won’t know the true form of <span class="math inline">\(f()\)</span>, nor the mechanism that generates the errors <span class="math inline">\(\epsilon\)</span></p></li>
<li><p>you will know the observations <span class="math inline">\(y\)</span> and <span class="math inline">\(\overrightarrow{x}\)</span>, as they are given in our data</p></li>
<li><p>the goal is to construct or “fit” a model f-hat that approximates <span class="math inline">\(\hat{f}()\)</span> while ignoring <span class="math inline">\(epsilon\)</span></p></li>
<li><p><strong>goal restated</strong>: separate the signal from the noise</p></li>
<li><p>then generate <em>fitted/predicted</em> values <span class="math inline">\(\hat{y} = \hat{f}(\overrightarrow{x})\)</span></p></li>
</ol>
<p><em>univariate</em>: only considering one variable at a time</p>
<p><em>overplotting</em>: adding random jitter <code>geom_jitter()</code></p>
<p><strong>Correlation coefficient</strong>:<br />
<code>cor()</code>, a summary statistic between -1/1 measuring the strength of linear association of two numerical variables, or the degree to which points fall on a line</p>
</div>
<div id="the-modeling-problem-for-prediction" class="section level3" number="3.1.2">
<h3><span class="header-section-number">3.1.2</span> The modeling problem for prediction</h3>
<p>Key difference in modeling goals:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Explanation:</strong><br />
We care about the form of <span class="math inline">\(\hat{f}()\)</span>, in particular any values quantifying relationships between <span class="math inline">\(y\)</span> and <span class="math inline">\(\overrightarrow{x}\)</span></p></li>
<li><p><strong>Prediction:</strong><br />
We don’t care so much about the form of <span class="math inline">\(\hat{f}()\)</span>, only that it yields “good” predictions <span class="math inline">\(\hat{y}\)</span> of <span class="math inline">\(y\)</span> based on <span class="math inline">\(\overrightarrow{x}\)</span></p></li>
</ol>
</div>
</div>
<div id="modeling-with-basic-regression" class="section level2" number="3.2">
<h2><span class="header-section-number">3.2</span> Modeling with Basic Regression</h2>
<div id="refresher-modeling-in-general" class="section level3" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Refresher: Modeling in general</h3>
<p><strong>Truth:</strong></p>
<p>Assumed model is <span class="math inline">\(y = f(\overrightarrow{x}) + \epsilon\)</span></p>
<p><strong>Goal:</strong></p>
<p>Given <span class="math inline">\(y\)</span> and <span class="math inline">\(overrightarrow{x}\)</span>, fit a model <span class="math inline">\(\hat{f}(\overrightarrow{x})\)</span> that approximates <span class="math inline">\(f(\overrightarrow{x})\)</span>, where <span class="math inline">\(\hat{y} = \hat{f}(\overrightarrow{x})\)</span> is the <em>fitted/predicted</em> value for the observed value <span class="math inline">\(y\)</span></p>
</div>
<div id="modeling-with-basic-regression-1" class="section level3" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Modeling with Basic Regression</h3>
<p><strong>Truth:</strong></p>
<ul>
<li>Assume <span class="math inline">\(f(x) = \beta_0 + \beta_1 \cdot x\)</span></li>
<li><em>Observed</em> value <span class="math inline">\(y = f(x) + \epsilon = \beta_0 + \beta_1 \cdot x + \epsilon\)</span></li>
</ul>
<p><strong>Fitted:</strong></p>
<ul>
<li>Assume <span class="math inline">\(\hat{f}(x) = \hat{\beta}_0 + \hat{\beta}_1 \cdot x\)</span></li>
<li><em>Fitted/predicted</em> value <span class="math inline">\(\hat{y} = \hat{f}(x) = \hat{\beta}_0 + \hat{\beta}_1 \cdot x\)</span></li>
</ul>
<p><strong>Regression line</strong></p>
<pre><code># Add a &quot;best-fitting&quot; line
geom_smooth(method = &quot;lm&quot;, se = FALSE)</code></pre>
<p>Equation for fitted regression line: <span class="math inline">\(\hat{y} = \hat{f}(\overrightarrow{x}) = \hat{\beta}_0 + \hat{\beta}_1 \cdot x\)</span></p>
<p><strong>Computing slope and intercept of regression line</strong></p>
<p>Using the formula form y ~ x, which is akin to <span class="math inline">\(\hat{y} = \hat{f}(\overrightarrow{x})\)</span></p>
<pre><code># Fit regression model using formula of form: y ~ x
# y: outcome, x: explanatory variable

model &lt;- lm(formula = score ~ age, data = evals)

# Output regression table using wrapper function
get_regression_table(model)</code></pre>
</div>
<div id="predicted-value" class="section level3" number="3.2.3">
<h3><span class="header-section-number">3.2.3</span> Predicted value</h3>
<ul>
<li><p>Predictive regression models in general:<br />
<span class="math inline">\(\hat{y} = \hat{f}(x) = \hat{\beta}_0 + \hat{\beta}_1 \cdot x\)</span></p></li>
<li><p>Our predictive model: <span class="math inline">\(sc\hat{o}re = 4.46 - 0.006 \cdot age\)</span></p></li>
<li><p>Our prediction: 4.46 - 0.006 x 40 = 4.22</p></li>
</ul>
</div>
<div id="prediction-error" class="section level3" number="3.2.4">
<h3><span class="header-section-number">3.2.4</span> Prediction error</h3>
<p><strong>Residuals as model errors</strong></p>
<ul>
<li>Residual = <span class="math inline">\(y - \hat{y}\)</span></li>
<li>Corresponds to <span class="math inline">\(\epsilon\)</span> from <span class="math inline">\(y = f(\overrightarrow{x}) + \epsilon\)</span></li>
<li>For our example instructor: <span class="math inline">\(y - \hat{y} = 3.5 - 4.22 = -0.72\)</span></li>
<li>With linear regression, sometimes you’ll obtain positive residuals and other times negative.<br />
In linear regression, they are on average 0.</li>
</ul>
<p><strong>Computing all predicted values</strong></p>
<pre><code># Get information on each point

model &lt;- lm(formula = score ~ age, data = evals)
get_regression_points(model)

# A tibble: 463 x 5      
      ID  score age   score_hat residual
&lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt; 
1     1   4.7    36      4.25    0.452
2     2   4.1    36      4.25   -0.148
3     3   3.9    36      4.25   -0.348
4     4   4.8    36      4.25    0.552
5     5   4.6    59      4.11    0.488
6     6   4.3    59      4.11    0.188
7     7   2.8    59      4.11   -1.31
8     8   4.1    51      4.16   -0.059
9     9   3.4    51      4.16   -0.759
10    10  4.5    40      4.22    0.276
# ... with 453 more rows</code></pre>
</div>
<div id="fitting-a-regression-with-a-categorical-x" class="section level3" number="3.2.5">
<h3><span class="header-section-number">3.2.5</span> Fitting a regression with a categorical x</h3>
<p>return group means of different categories of x</p>
<pre><code># Fit regression model
model_score_3 &lt;- lm(score ~ gender, data = evals)

# Get regression table
get_regression_table(model_score_3)

# A tibble: 2 x 7
term       estimate std_error statistic p_value lower_ci upper_ci  &lt;chr&gt;         &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;   &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
1 intercept     4.09      0.039    106.     0        4.02     4.17
2 gendermale    0.142     0.051      2.78   0.006    0.042    0.241

# Compute group means based on gender
evals %&gt;%   
group_by(gender) %&gt;%   
summarize(avg_score = mean(score), sd_score = sd(score))

# A tibble: 2 x 2
gender avg_score    sd_score
&lt;fct&gt;      &lt;dbl&gt;    &lt;dbl&gt;
1 female      4.09    0.564
2 male        4.23    0.522

# Get information on each point
get_regression_points(model_score_3)
</code></pre>
</div>
</div>
<div id="modeling-with-multiple-regression" class="section level2" number="3.3">
<h2><span class="header-section-number">3.3</span> Modeling with Multiple Regression</h2>
<div id="combining-numerical-variables" class="section level3" number="3.3.1">
<h3><span class="header-section-number">3.3.1</span> Combining numerical variables</h3>
<p>Fit regression model using formula of form: y ~ x1 + x2</p>
<pre><code># y tilde x1 PLUS x2, where the plus indicates you are using more than one explanatory variable
model_price_1 &lt;- lm(log10_price ~ log10_size + yr_built, data = house_prices)

# Output regression table
get_regression_table(model_price_1)</code></pre>
<p><strong>Best fit and residuals</strong></p>
<pre><code># Computing all predicted values and residuals
get_regression_points(model_price_1)

# Square all residuals and sum them
get_regression_point(model_price_1) %&gt;%
  mutate(sq_residuals = residuals^2) %&gt;%
  summarize(sum_sq_residuals = sum(sq_residuals))</code></pre>
<p><img src="rlearning-plane-residuals.png" width="600"></p>
<p>Just as with “best-fitting” regression lines, of all possible planes, the regression plane minimizes the sum of squared residuals. This is what is meant by “best fitting” plane.</p>
</div>
<div id="combining-numerical-and-categorical-variables" class="section level3" number="3.3.2">
<h3><span class="header-section-number">3.3.2</span> Combining numerical and categorical variables</h3>
<p>Recall the notion of a “baseline for comparison” level when using a categorical variable in a regression model.</p>
<pre><code>model_price_3 &lt;- lm(log10_price ~ log10_size + condition, data = house_prices)

get_regression_table(model_price_3)

# A tibble: 6 x 7
term  estimate  std_error statist</code></pre>
<p>house price for condition3:<br />
<span class="math inline">\(\hat{y} = 2.88 +0.032 + 0.837 \cdot 2.90 = 5.34\)</span></p>
<p>importing new data frame:<br />
<code>get_regression_points(model_price_3, newdata = new_houses)</code></p>
</div>
</div>
<div id="model-assessment-and-selection" class="section level2" number="3.4">
<h2><span class="header-section-number">3.4</span> Model Assessment and Selection</h2>
<div id="assessing-with-sum-of-squared-residuals" class="section level3" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> Assessing with sum of squared residuals</h3>
<pre><code>get_regression_point(model_price_1) %&gt;%
  mutate(sq_residuals = residuals^2) %&gt;%
  summarize(sum_sq_residuals = sum(sq_residuals))</code></pre>
</div>
<div id="assessing-with-r-squared" class="section level3" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Assessing with R-squared</h3>
<p>R-squared is another numerical summary of how well a model fits points.</p>
<p><strong>Variance 方差</strong>: another measure of variability/spread, <span class="math inline">\(sd ^ 2\)</span></p>
<p><strong>R-squared</strong><br />
1 minus the variance of the residuals over the variance of the outcome variable:<br />
<span class="math inline">\(R^2 = 1 - \dfrac{Var(residuals)}{Var(y)}\)</span></p>
<ul>
<li>Since <span class="math inline">\(Var(y) \geqslant Var(residuals)\)</span>, so <span class="math inline">\(R^2\)</span> is between 0 &amp; 1</li>
<li>Smaller <span class="math inline">\(R^2\)</span> ~ “poorer fit”</li>
<li><span class="math inline">\(R^2 = 1\)</span> ~ “perfect fit” and <span class="math inline">\(R^2 = 0\)</span> ~ “no fit”</li>
</ul>
<p><span class="math inline">\(R^2\)</span> is the proportion of the total variation in the outcome variable <span class="math inline">\(y\)</span> that the model explains.</p>
<pre><code>get_regression_points(model_price_1) %&gt;%
  summarize(r_squared = 1 - var(residual) / var(log10_price))</code></pre>
</div>
<div id="assessing-predictions-with-rmse" class="section level3" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> Assessing predictions with RMSE</h3>
<p>Root mean squared error 均方根误差:</p>
<pre><code># Mean squared error
get_regression_point(model_price_1) %&gt;%
  mutate(sq_residuals = residuals^2) %&gt;%
  summarize(mse = mean(sq_residuals))
  
# Root mean squared error 最后一步开根号
get_regression_point(model_price_1) %&gt;%
  mutate(sq_residuals = residuals^2) %&gt;%
  summarize(mse = mean(sq_residuals)) %&gt;%
  mutate(rmse = sqrt(mse))</code></pre>
<p>RMSE can be thought of as the “typical” error a predictive model will make.</p>
</div>
<div id="validation-set-prediction-framework" class="section level3" number="3.4.4">
<h3><span class="header-section-number">3.4.4</span> “Validation set” prediction framework</h3>
<p>This forms the backbone of a well-known machine learning method for model assessment called cross-validation.</p>
<p><strong>Validation set approach</strong></p>
<p>Use two independent dataset to:</p>
<ol style="list-style-type: decimal">
<li>Train/fit your model on one set of data</li>
<li>Evaluate your model’s predictive power, i.e., validate your model’s performance on a different set of data</li>
</ol>
<p><strong>Training/test set split in R</strong></p>
<pre><code># Randomly shuffle order of rows:
house_price_shuffled &lt;- house_prices %&gt;%
  sample_frac(size = 1, replace = FALSE)

# Split into train and test:
train &lt;- house_price_shuffled %&gt;%
  slice(1:10000)
test &lt;- house_price_shuffled %&gt;%
  slice(10001:21613) %&gt;%

# Train model on train:
train_model_price_1 &lt;- lm(log10_price ~ log10_size + yr_built, data = train)

# Get predictions on test:
get_regression_points(train_model_price_1, newdata = test)

# Assessing and comparing RMSE</code></pre>
</div>
</div>
<div id="where-to-go-from-here" class="section level2" number="3.5">
<h2><span class="header-section-number">3.5</span> Where to go from here?</h2>
<ul>
<li><p>R source code for all videos<br />
Available at <a href="http://bit.ly/modeling_tidyverse" class="uri">http://bit.ly/modeling_tidyverse</a></p></li>
<li><p>DataCamp courses using other models<br />
Courses with different <span class="math inline">\(f()\)</span> in <span class="math inline">\(y=f(\overrightarrow{x})+ε\)</span>:</p>
<ul>
<li><a href="https://learn.datacamp.com/courses/machine-learning-with-tree-based-models-in-r">Machine Learning with Tree-Based Models in R</a></li>
<li><a href="https://learn.datacamp.com/courses/supervised-learning-in-r-case-studies">Supervised Learning in R: Case Studies</a></li>
</ul></li>
<li><p>ModernDive: <a href="https://moderndive.com/">Online textbook</a></p>
<ul>
<li>Uses <code>tidyverse</code> tools: <code>ggplot2</code> and <code>dplyr</code></li>
<li>Expands on the regression models from this course</li>
<li>Uses <code>evals</code> and <code>house_prices</code> datasets (and more)</li>
<li>Goal: Statistical inference via data science</li>
</ul></li>
<li><p>More to explore:</p>
<ul>
<li>Parallel slopes model</li>
<li>Polynomial model</li>
<li>Tree models</li>
</ul></li>
</ul>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="exploratory-data-analysis.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="correlation-and-regression-in-r.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
